<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>単語帳</title>

<style>
body { font-family: sans-serif; margin:20px; }

#editor { display:none; }

table { width:100%; }
td input { width:100%; }

.card {
  border:1px solid #aaa;
  padding:40px;
  font-size:28px;
  text-align:center;
  margin:20px 0;
  cursor:pointer;
  white-space: pre-line;
}
</style>
</head>

<body>

<button onclick="toggleMode()">編集モード切替</button>

<div id="viewer">
  <div id="card" class="card"></div>
  <button onclick="prev()">←</button>
  <button onclick="next()">→</button>
</div>

<div id="editor">
  <table id="table"></table>
  <button onclick="addRow()">行追加</button>
  <button onclick="download()">保存(JSON)</button>
</div>

<script>
let cards = [];
let index = 0;

async function load() {
  const res = await fetch("cards.json");
  cards = await res.json();
  show();
}

function show() {
  if (!cards.length) return;
  document.getElementById("card").textContent =
    cards[index].front + "\n\n" + cards[index].back;
}

function next(){ if(index<cards.length-1) index++; show(); }
function prev(){ if(index>0) index--; show(); }

function toggleMode(){
  const v = document.getElementById("viewer");
  const e = document.getElementById("editor");

  if(e.style.display==="none"){
    buildEditor();
    e.style.display="block";
    v.style.display="none";
  } else {
    e.style.display="none";
    v.style.display="block";
  }
}

function buildEditor(){
  const t = document.getElementById("table");
  t.innerHTML="";

  cards.forEach((c,i)=>{
    const row = t.insertRow();
    row.insertCell().innerHTML =
      `<input value="${c.front}" onchange="cards[${i}].front=this.value">`;
    row.insertCell().innerHTML =
      `<input value="${c.back}" onchange="cards[${i}].back=this.value">`;
  });
}

function addRow(){
  cards.push({front:"", back:""});
  buildEditor();
}

function download(){
  const blob = new Blob(
    [JSON.stringify(cards,null,2)],
    {type:"application/json"}
  );
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "cards.json";
  a.click();
}

load();
</script>

</body>
</html>