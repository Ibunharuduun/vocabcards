<script>
let cards = [];
let index = 0;

// ★ここを自分のスプレッドシートCSV公開URLに変更
const SHEET_URL = "https://docs.google.com/spreadsheets/d/XXXX/export?format=csv";

async function load() {
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  cards = csvToCards(text);
  show();
}

// CSV → [{front,back}] に変換
function csvToCards(text){
  const lines = text.trim().split("\n");
  const rows = lines.map(l => l.split(","));
  
  const header = rows.shift(); // front,back
  
  return rows.map(r => ({
    front: r[0] ?? "",
    back: r[1] ?? ""
  }));
}

function show() {
  if (!cards.length) return;
  document.getElementById("card").textContent =
    cards[index].front + "\n\n" + cards[index].back;
}

function next(){ if(index<cards.length-1) index++; show(); }
function prev(){ if(index>0) index--; show(); }

function toggleMode(){
  const v = document.getElementById("viewer");
  const e = document.getElementById("editor");

  if(e.style.display==="none"){
    buildEditor();
    e.style.display="block";
    v.style.display="none";
  } else {
    e.style.display="none";
    v.style.display="block";
  }
}

function buildEditor(){
  const t = document.getElementById("table");
  t.innerHTML="";

  cards.forEach((c,i)=>{
    const row = t.insertRow();
    row.insertCell().innerHTML =
      `<input value="${c.front}" onchange="cards[${i}].front=this.value">`;
    row.insertCell().innerHTML =
      `<input value="${c.back}" onchange="cards[${i}].back=this.value">`;
  });
}

function addRow(){
  cards.push({front:"", back:""});
  buildEditor();
}

// ★保存はローカルJSONのまま（Sheetsへ直接書き戻しはAPIが必要）
function download(){
  const blob = new Blob(
    [JSON.stringify(cards,null,2)],
    {type:"application/json"}
  );
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "cards.json";
  a.click();
}

load();
</script>